import { useEffect, useState } from "react";
import authService from "../service/authService";
import { useDispatch, useSelector } from "react-redux";
import { store } from "../redux/store";
import { login } from "../redux/auth/Action";
import { jwtDecode } from "jwt-decode";
import { useNavigate } from "react-router-dom";

function Login() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const auth = useSelector((store) => store.auth);
  console.log(auth);
  const dispatch = useDispatch();
  const jwt = localStorage.getItem("jwt");
  const navigate = useNavigate();
  const handleLogin = (e) => {
    e.preventDefault();
    const data = new FormData(e.currentTarget);
    data.append("email", email);
    data.append("password", password);
    dispatch(login(data));
  };
  useEffect(() => {
    if (auth?.signin?.userDTO?.role === "ADMIN") {
      navigate("/dashboard");
    }
  }, [auth?.signin]);
  return (
    <>
      <div className="main">
        <div className="wrapper">
          <div className="login-top">
            <div className="logo">
              <svg
                width="140"
                height="30"
                viewBox="0 0 268 42"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g filter="url(#filter0_d_1_3)">
                  <path
                    d="M12.485 7.575V13.965H22.79V19.905H12.485V26.835H24.14V33H4.79V1.41H24.14V7.575H12.485Z"
                    fill="#285BE6"
                  />
                  <path
                    d="M42.0257 33L37.7457 26.8L34.1457 33H26.7457L34.1057 21.6L26.5457 10.68H34.2257L38.5057 16.84L42.1057 10.68H49.5057L42.0257 21.92L49.7057 33H42.0257ZM50.9813 21.8C50.9813 19.5067 51.408 17.4933 52.2613 15.76C53.1413 14.0267 54.328 12.6933 55.8213 11.76C57.3147 10.8267 58.9813 10.36 60.8213 10.36C62.3947 10.36 63.768 10.68 64.9413 11.32C66.1413 11.96 67.0613 12.8 67.7013 13.84V10.68H74.5413V33H67.7013V29.84C67.0347 30.88 66.1013 31.72 64.9013 32.36C63.728 33 62.3547 33.32 60.7813 33.32C58.968 33.32 57.3147 32.8533 55.8213 31.92C54.328 30.96 53.1413 29.6133 52.2613 27.88C51.408 26.12 50.9813 24.0933 50.9813 21.8ZM67.7013 21.84C67.7013 20.1333 67.2213 18.7867 66.2613 17.8C65.328 16.8133 64.1813 16.32 62.8213 16.32C61.4613 16.32 60.3013 16.8133 59.3413 17.8C58.408 18.76 57.9413 20.0933 57.9413 21.8C57.9413 23.5067 58.408 24.8667 59.3413 25.88C60.3013 26.8667 61.4613 27.36 62.8213 27.36C64.1813 27.36 65.328 26.8667 66.2613 25.88C67.2213 24.8933 67.7013 23.5467 67.7013 21.84ZM107.97 10.44C110.743 10.44 112.943 11.28 114.57 12.96C116.223 14.64 117.05 16.9733 117.05 19.96V33H110.25V20.88C110.25 19.44 109.863 18.3333 109.09 17.56C108.343 16.76 107.303 16.36 105.97 16.36C104.636 16.36 103.583 16.76 102.81 17.56C102.063 18.3333 101.69 19.44 101.69 20.88V33H94.8898V20.88C94.8898 19.44 94.5031 18.3333 93.7298 17.56C92.9831 16.76 91.9431 16.36 90.6098 16.36C89.2764 16.36 88.2231 16.76 87.4498 17.56C86.7031 18.3333 86.3298 19.44 86.3298 20.88V33H79.4898V10.68H86.3298V13.48C87.0231 12.5467 87.9298 11.8133 89.0498 11.28C90.1698 10.72 91.4364 10.44 92.8498 10.44C94.5298 10.44 96.0231 10.8 97.3298 11.52C98.6631 12.24 99.7031 13.2667 100.45 14.6C101.223 13.3733 102.276 12.3733 103.61 11.6C104.943 10.8267 106.396 10.44 107.97 10.44ZM125.274 8.36C124.074 8.36 123.087 8.01333 122.314 7.32C121.567 6.6 121.194 5.72 121.194 4.68C121.194 3.61333 121.567 2.73333 122.314 2.04C123.087 1.32 124.074 0.959998 125.274 0.959998C126.447 0.959998 127.407 1.32 128.154 2.04C128.927 2.73333 129.314 3.61333 129.314 4.68C129.314 5.72 128.927 6.6 128.154 7.32C127.407 8.01333 126.447 8.36 125.274 8.36ZM128.674 10.68V33H121.834V10.68H128.674ZM147.23 10.44C149.844 10.44 151.924 11.2933 153.47 13C155.044 14.68 155.83 17 155.83 19.96V33H149.03V20.88C149.03 19.3867 148.644 18.2267 147.87 17.4C147.097 16.5733 146.057 16.16 144.75 16.16C143.444 16.16 142.404 16.5733 141.63 17.4C140.857 18.2267 140.47 19.3867 140.47 20.88V33H133.63V10.68H140.47V13.64C141.164 12.6533 142.097 11.88 143.27 11.32C144.444 10.7333 145.764 10.44 147.23 10.44ZM159.224 21.8C159.224 19.5067 159.65 17.4933 160.504 15.76C161.384 14.0267 162.57 12.6933 164.064 11.76C165.557 10.8267 167.224 10.36 169.064 10.36C170.637 10.36 172.01 10.68 173.184 11.32C174.384 11.96 175.304 12.8 175.944 13.84V10.68H182.784V33H175.944V29.84C175.277 30.88 174.344 31.72 173.144 32.36C171.97 33 170.597 33.32 169.024 33.32C167.21 33.32 165.557 32.8533 164.064 31.92C162.57 30.96 161.384 29.6133 160.504 27.88C159.65 26.12 159.224 24.0933 159.224 21.8ZM175.944 21.84C175.944 20.1333 175.464 18.7867 174.504 17.8C173.57 16.8133 172.424 16.32 171.064 16.32C169.704 16.32 168.544 16.8133 167.584 17.8C166.65 18.76 166.184 20.0933 166.184 21.8C166.184 23.5067 166.65 24.8667 167.584 25.88C168.544 26.8667 169.704 27.36 171.064 27.36C172.424 27.36 173.57 26.8667 174.504 25.88C175.464 24.8933 175.944 23.5467 175.944 21.84ZM200.172 27.2V33H196.692C194.212 33 192.279 32.4 190.892 31.2C189.505 29.9733 188.812 27.9867 188.812 25.24V16.36H186.092V10.68H188.812V5.24H195.652V10.68H200.132V16.36H195.652V25.32C195.652 25.9867 195.812 26.4667 196.132 26.76C196.452 27.0533 196.985 27.2 197.732 27.2H200.172ZM207.422 8.36C206.222 8.36 205.235 8.01333 204.462 7.32C203.715 6.6 203.342 5.72 203.342 4.68C203.342 3.61333 203.715 2.73333 204.462 2.04C205.235 1.32 206.222 0.959998 207.422 0.959998C208.595 0.959998 209.555 1.32 210.302 2.04C211.075 2.73333 211.462 3.61333 211.462 4.68C211.462 5.72 211.075 6.6 210.302 7.32C209.555 8.01333 208.595 8.36 207.422 8.36ZM210.822 10.68V33H203.982V10.68H210.822ZM225.939 33.32C223.752 33.32 221.779 32.8533 220.019 31.92C218.285 30.9867 216.912 29.6533 215.899 27.92C214.912 26.1867 214.419 24.16 214.419 21.84C214.419 19.5467 214.925 17.5333 215.939 15.8C216.952 14.04 218.339 12.6933 220.099 11.76C221.859 10.8267 223.832 10.36 226.019 10.36C228.205 10.36 230.179 10.8267 231.939 11.76C233.699 12.6933 235.085 14.04 236.099 15.8C237.112 17.5333 237.619 19.5467 237.619 21.84C237.619 24.1333 237.099 26.16 236.059 27.92C235.045 29.6533 233.645 30.9867 231.859 31.92C230.099 32.8533 228.125 33.32 225.939 33.32ZM225.939 27.4C227.245 27.4 228.352 26.92 229.259 25.96C230.192 25 230.659 23.6267 230.659 21.84C230.659 20.0533 230.205 18.68 229.299 17.72C228.419 16.76 227.325 16.28 226.019 16.28C224.685 16.28 223.579 16.76 222.699 17.72C221.819 18.6533 221.379 20.0267 221.379 21.84C221.379 23.6267 221.805 25 222.659 25.96C223.539 26.92 224.632 27.4 225.939 27.4ZM254.848 10.44C257.461 10.44 259.541 11.2933 261.088 13C262.661 14.68 263.448 17 263.448 19.96V33H256.648V20.88C256.648 19.3867 256.261 18.2267 255.488 17.4C254.714 16.5733 253.674 16.16 252.368 16.16C251.061 16.16 250.021 16.5733 249.248 17.4C248.474 18.2267 248.088 19.3867 248.088 20.88V33H241.248V10.68H248.088V13.64C248.781 12.6533 249.714 11.88 250.888 11.32C252.061 10.7333 253.381 10.44 254.848 10.44Z"
                    fill="black"
                  />
                </g>
                <defs>
                  <filter
                    id="filter0_d_1_3"
                    x="0.789993"
                    y="0.959999"
                    width="266.658"
                    height="40.36"
                    filterUnits="userSpaceOnUse"
                    colorInterpolationFilters="sRGB"
                  >
                    <feFlood floodOpacity="0" result="BackgroundImageFix" />
                    <feColorMatrix
                      in="SourceAlpha"
                      type="matrix"
                      values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                      result="hardAlpha"
                    />
                    <feOffset dy="4" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix
                      type="matrix"
                      values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                    />
                    <feBlend
                      mode="normal"
                      in2="BackgroundImageFix"
                      result="effect1_dropShadow_1_3"
                    />
                    <feBlend
                      mode="normal"
                      in="SourceGraphic"
                      in2="effect1_dropShadow_1_3"
                      result="shape"
                    />
                  </filter>
                </defs>
              </svg>
            </div>
            <button>Đăng kí</button>
          </div>

          <div className="form-container">
            <div className="sign-in">
              <form action="" className="form" onSubmit={handleLogin}>
                <div className="title">
                  <h3>Đăng nhập vào tài khoản</h3>
                  <div className="others-login">
                    <h3>Đăng nhập với</h3>
                    <div className="social-icons">
                      <a href="##" className="icon">
                        <i className="fa-brands fa-facebook-f"></i>
                      </a>
                      <a href="###" className="icon">
                        <i className="fa-brands fa-google"></i>
                      </a>
                      <a href="###" className="icon">
                        <i className="fa-brands fa-linkedin-in"></i>
                      </a>
                    </div>
                  </div>
                </div>
                <div className="input-field">
                  <i className="fa-solid fa-user"></i>
                  <input
                    type="text"
                    placeholder="Địa chỉ email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                  />
                </div>
                <div className="input-field">
                  <i className="fa-solid fa-lock"></i>
                  <input
                    type="password"
                    placeholder="Mật khẩu"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                  />
                </div>
                <div className="forgot-submit">
                  <a href="##">Quên mật khẩu?</a>
                  <button type="submit">Đăng nhập</button>
                </div>
              </form>
            </div>
            <div className="image">
              <img src="/online-learning.svg" alt="" />
            </div>
          </div>
        </div>
      </div>
    </>
  );
}

export default Login;
